# Generated by makelib.pl, Thu Aug 30 15:46:54 2012
# -*- mode: mak; indent-tabs-mode: t; tab-width: 8 -*-
# $Id: Makefile.in,v 1.7 2020/06/18 20:35:16 cvsuser Exp $
# libiconv/esdb table generating
#
#
#

@SET_MAKE@
ROOT=		@abs_top_builddir@
top_builddir=	@top_builddir@

# Compilers, programs

RM=		@RM@
PERL=		@PERL@

# Configuration

ifeq ("$(BUILD_TYPE)","")	#default
BUILD_TYPE=	debug
MAKEFLAGS+=	BUILD_TYPE=debug
endif
ifneq ("$(BUILD_TYPE)","release")
RTSUFFIX=d
endif

# Directories

D_BIN=		$(ROOT)/bin@TOOLCHAINEXT@/$(BUILD_TYPE)
D_I18N=		$(D_BIN)/i18n
D_I18N_ESDB=	$(D_I18N)/esdb


#########################################################################################
# Targets

VERSION=	201208
VERSIONSPEC=	$(subst .,:,$(VERSION))
PACKED=		esdb-$(VERSION).tgz

SUBDIR=		APPLE AST BIG5 CBM CP DEC EUC EBCDIC GB GEORGIAN ISO-2022 \
		ISO-8859 ISO646 KAZAKH KOI MISC TCVN UTF

SRC_esdb.alias=	$(foreach dir,$(SUBDIR),$(wildcard ./$(dir)/esdb.alias* ./$(dir)/*.alias))
SRC_esdb.dir=	$(foreach dir,$(SUBDIR),$(wildcard ./$(dir)/esdb.dir* ./$(dir)/*.part))
SRC_esdbs=	$(foreach dir,$(SUBDIR),$(wildcard ./$(dir)/*.src))


#########################################################################################
# Rules

.PHONY:			build release debug unpacked
all:			source
unpacked:		esdb.alias.db esdb.dir.db installdb esdbs

release:
		$(MAKE) BUILD_TYPE=release $(filter-out release, $(MAKECMDGOALS))
debug:
		$(MAKE) BUILD_TYPE=debug $(filter-out debug, $(MAKECMDGOALS))

XCLEAN+=	esdb.alias.db esdb.dir.db esdb.alias esdb.dir

#recursive usage, so SRC_ elements are always expanded
.PHONY:
source:			.unpacked.$(VERSION)
		$(MAKE) unpacked

.unpacked.$(VERSION):	$(PACKED)
		@echo "do not delete, managed file" > $@
		@echo "unpacking source $(PACKED)"
		@gzip -c -d $(PACKED) | tar -xvf -

clean:
		-@$(RM) $(RMFLAGS) $(CLEAN) $(XCLEAN) >/dev/null 2>&1

.PHONY:		installdb
installdb:		$(D_I18N_ESDB)/.created
		@echo publishing databases ...
		-cp esdb.alias.db $(D_I18N_ESDB)
		-cp esdb.alias $(D_I18N_ESDB)
		-cp esdb.dir.db $(D_I18N_ESDB)
		-cp esdb.dir $(D_I18N_ESDB)

$(D_I18N_ESDB)/.created:
		-@mkdir $(D_I18N)
		-@mkdir $(@D)
		@echo "do not delete, managed directory" > $@

esdb.alias.db:	esdb.alias
	$(D_BIN)/mkesdb -m -o esdb.alias.db esdb.alias

esdb.dir.db:	esdb.dir
	$(D_BIN)/mkesdb -m -o esdb.dir.db esdb.dir

esdb.alias:	$(SRC_esdb.alias)
	@$(PERL) ./esdbtable.pl --mode=alias --outdir=$(D_I18N_ESDB) $^

esdb.dir:	$(SRC_esdb.dir)
	@$(PERL) ./esdbtable.pl --mode=dir --outdir=$(D_I18N_ESDB) $^

.PHONY:		esdbs
esdbs:		$(SRC_esdbs)
	@$(PERL) ./esdbtable.pl --mode=esdb --bindir=$(D_BIN) --outdir=$(D_I18N_ESDB) $^
	$(D_BIN)/mkesdb -m -o esdb.alias.db esdb.alias

#end
