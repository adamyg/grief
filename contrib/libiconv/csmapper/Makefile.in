# Generated by makelib.pl, Thu Aug 30 15:46:54 2012
# -*- mode: mak; indent-tabs-mode: t; tab-width: 8 -*-
# $Id: Makefile.in,v 1.7 2020/06/18 20:35:16 cvsuser Exp $
# libiconv/csmapper table generating
#
#
#

@SET_MAKE@
ROOT=		@abs_top_builddir@
top_builddir=	@top_builddir@

# Compilers, programs

RM=		@RM@
PERL=		@PERL@

# Configuration

ifeq ("$(BUILD_TYPE)","")	#default
BUILD_TYPE=	debug
MAKEFLAGS+=	BUILD_TYPE=debug
endif
ifneq ("$(BUILD_TYPE)","release")
RTSUFFIX=d
endif

# Directories

D_BIN=		$(ROOT)/bin@TOOLCHAINEXT@/$(BUILD_TYPE)
D_I18N=		$(D_BIN)/i18n
D_I18N_CSMAPPER=$(D_I18N)/csmapper


#########################################################################################
# Targets

VERSION=	201208
VERSIONSPEC=	$(subst .,:,$(VERSION))
PACKED=		csmapper-$(VERSION).tgz

SUBDIR=		APPLE AST BIG5 CBM CNS CP EBCDIC GB GEORGIAN ISO646 ISO-8859 \
		JIS KAZAKH KOI KS MISC TCVN

SRC_csm.dir=	$(foreach dir,$(SUBDIR),$(wildcard mapper.dir.src ./$(dir)/*.dir* ./$(dir)/*.part))
SRC_csm.pivot=	$(foreach dir,$(SUBDIR),$(wildcard charset.pivot.src ./$(dir)/*.pivot* ./$(dir)/*.part))
SRC_csm=	$(foreach dir,$(SUBDIR),$(wildcard ./$(dir)/*%*.src ./ISO646/*.646))


#########################################################################################
# Rules

.PHONY:			build release debug unpacked
build:			source
unpacked:		mapper.dir.db charset.pivot.pvdb installdb mps

release:
		$(MAKE) BUILD_TYPE=release $(filter-out release, $(MAKECMDGOALS))
debug:
		$(MAKE) BUILD_TYPE=debug $(filter-out debug, $(MAKECMDGOALS))

XCLEAN+=	mapper.dir.db charset.pivot.pvdb mapper.dir charset.pivot

#recursive usage, so SRC_ elements are always expanded
.PHONY:
source:			.unpacked.$(VERSION)
		$(MAKE) unpacked

.unpacked.$(VERSION):	$(PACKED)
		@echo "do not delete, managed file" > $@
		@echo "unpacking source $(PACKED)"
		@gzip -c -d $(PACKED) | tar -xvf -

clean:
		-@$(RM) $(RMFLAGS) $(CLEAN) $(XCLEAN) >/dev/null 2>&1

.PHONY:		installdb
installdb:		$(D_I18N_CSMAPPER)/.created
		@echo publishing databases ...
		-cp mapper.dir.db $(D_I18N_CSMAPPER)
		-cp mapper.dir $(D_I18N_CSMAPPER)
		-cp charset.pivot.pvdb $(D_I18N_CSMAPPER)
		-cp charset.pivot $(D_I18N_CSMAPPER)

$(D_I18N_CSMAPPER)/.created:
		-@mkdir $(D_I18N)
		-@mkdir $(@D)
		@echo "do not delete, managed directory" > $@

mapper.dir.db:		mapper.dir
	$(D_BIN)/mkcsmapper -m -o$@ $^

charset.pivot.pvdb:	charset.pivot
	$(D_BIN)/mkcsmapper -p -o$@ $^

mapper.dir:		$(SRC_csm.dir)
	@$(PERL) ./csmtable.pl --mode=dir --outdir=$(D_I18N_CSMAPPER) $^

charset.pivot:		$(SRC_csm.pivot)
	@$(PERL) ./csmtable.pl --mode=pivot --outdir=$(D_I18N_CSMAPPER) $^

.PHONY:		mps
mps:			$(SRC_csm)
	@$(PERL) ./csmtable.pl --mode=mps --bindir=$(D_BIN) --outdir=$(D_I18N_CSMAPPER) $^

#end
